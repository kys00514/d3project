<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src="components/scatterplot.js"></script>
    <script src="components/histogram.js"></script>
    <script src="components/datatable.js"></script>
    <script src="components/piegraph.js"></script>
    <script src="data.js"></script>

    <title>Android App Visualizer</title>
    <style>
      body {
        background: white;
        overflow-y: scroll;
      }

      .container {
        width: 99vw;
        background: white;
        margin: 0px;
        padding: 0px;
      }

      /* In the <style> tag in index.html */
      .brushed {
        stroke-width: 1;
        stroke: gray;
        r: 7;
      }
      .row{
        width: 99vw;
      }
   
    </style>
  </head>

  <body>
    <header>
      <nav class="navbar navbar-light bg-light" style="width: 99vw">
       
          <span class="navbar-brand mb-0 h1" style="margin-left: 40vw;;">Android App Data Visualizer</span>
       
      </nav>
    </header>
    <div class="row">
       
      <div class="form-check form-switch" style="margin-left: 40vw;">
        <input
          class="form-check-input"
          type="checkbox"
          role="switch"
          id="use-color"
         
        />
        <label class="form-check-label" for="use-color"
          >Reduce Data</label
        >
      </div>
    
  </div>
    <div class="container" >
      <div class="row pt-2" style="width: 99vw">
        <div class="col-1 text-end pe-2"><strong>X:</strong></div>
        <div class="col-11">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="x-encoding" value="Installs" id="x-sl" checked="">
            <label class="form-check-label" for="x-sl">Installs</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="x-encoding" value="Rating" id="x-sw">
            <label class="form-check-label" for="x-sw">Rating</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="x-encoding" value="Size" id="x-pl">
            <label class="form-check-label" for="x-pl">Size</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="x-encoding" value="Android Ver" id="x-pw">
            <label class="form-check-label" for="x-pw">Version</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="x-encoding" value="Price" id="x-pw">
            <label class="form-check-label" for="x-pw">Price</label>
          </div>
          <div class="form-check form-check-inline "style="margin-left: 30vw;">
            <label >Choose a Variable:</label>

            <select name="Options" id="options">
              <option value="Android Ver">Version</option>
              <option value="Rating">Rating</option>
              <option value="Reviews">Reviews</option>
              <option value="Size">Size</option>
              <option value="Installs">Installs</option>
              <option value="Price">Price</option>
            </select>
              
            </div>
          
        </div>
          
      
        
      </div>
      
      <div class="row">
        <div class="col-1 text-end pe-2"><strong>Y:</strong></div>
        <div class="col-11">
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="y-encoding"
              value="Installs"
              id="y-sl"
            />
            <label class="form-check-label" for="y-sl">Installs</label>
          </div>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="y-encoding"
              value="Rating"
              id="y-sw"
              checked
            />
            <label class="form-check-label" for="y-sw">Rating</label>
          </div>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="y-encoding"
              value="Size"
              id="y-pl"
            />
            <label class="form-check-label" for="y-pl">Size</label>
          </div>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="y-encoding"
              value="Android Ver"
              id="y-pw"
            />
            <label class="form-check-label" for="y-pw">Version</label>
          </div>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="y-encoding"
              value="Price"
              id="y-pw"
            />
            <label class="form-check-label" for="y-pw">Price</label>
          </div>
          
        </div>
      </div>

      
      <div class="text-center" style="width: 99vw;">
        <svg width="49.5vw" height="1" id="scatterplot"></svg>

        <svg width="49.5vw" height="1" id="histogram"></svg>
      </div>
      <div class="text-center" style="width: 99vw">
        <svg width="49.5vw" height="1" id="piegraph"></svg>
      </div>
      <div class="rowss">
        
          <div class="form-check form-switch" style="margin-left: 35vw;">
            <input class="form-check-input" type="checkbox" role="switch" id="use-datatype">
            <label class="form-check-label" for="use-datatype"> Data Types</label>
            <label for="sort" style="margin-left: 10vw;">Sort Table By:</label>

            <select name="Sort Table" id="options1" >
              <option value="App">App Name</option>
              <option value="Android Ver">Version</option>
              
              <option value="Genres">Genres</option>
              
            </select>    
        </div>
    


      </div>
      <div class="container">
        <div class="row">
          <div class="col">
            <table class="table table-striped text-center">
              <thead>
                <tr>
                  <th>App Name</th>
                  <th id="row1">Rating</th>
                  <th id="row2">Reviews</th>
                  <th id="row3">Size</th>
                  <th id="row4">Installs</th>
                  <th id="row5">Current Version</th>
                  <th id="row6">Android Version</th>
                </tr>
              </thead>
              <tbody id="data-table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <script>
      let data, brushedData, scatterplot, histogram, dataTable;
      let installarr = [];
      function updateScatterplot() {
        
        let xVar = d3
          .select("input[type=radio][name=x-encoding]:checked")
          .property("value");
        let yVar = d3
          .select("input[type=radio][name=y-encoding]:checked")
          .property("value");
        let useFilter = d3.select("#use-color").property("checked");
        
  
        scatterplot.update(xVar, yVar, "variety", useFilter);


      }

      function updateHistogram() {
        var selectElement = document.getElementById('options');
        var selectedValue = selectElement.value;
      
        histogram.update(
          brushedData && brushedData.length > 0 ? brushedData : data,
          selectedValue , false
        );
      }

      function updateDataTable() {
        let datatype = d3.select("#use-datatype").property("checked");
        let sort = d3.select("#options1").property("value");
        
        if (datatype===true){
          document.getElementById('row1').textContent = 'Category';
          document.getElementById('row2').textContent = 'Paid Type';
          document.getElementById('row3').textContent = 'Price';
          document.getElementById('row4').textContent = 'Content Rating';
          document.getElementById('row5').textContent = 'Genre';
          document.getElementById('row6').textContent = 'Last Updated';
        }
        else{
          document.getElementById('row1').textContent = 'Rating';
          document.getElementById('row2').textContent = 'Reviews';
          document.getElementById('row3').textContent = 'Size';
          document.getElementById('row4').textContent = 'Installs';
          document.getElementById('row5').textContent = 'Current Version';
          document.getElementById('row6').textContent = 'Android Version';
        }
        dataTable.update(
          brushedData && brushedData.length > 0 ? brushedData : null,
          data.columns,datatype,sort
        );
      }
      function updatepiegraph(){
        piegraph.update( brushedData && brushedData.length > 0 ? brushedData : data,
          "Genres" , true);
      }

      const csvData = d3.csvParse(csvText);


let uniqueDataMap = new Map(); 

csvData.forEach((d) => {

  d["Rating"] = +d["Rating"];
  d["Installs"] = parseInt(d["Installs"].replace(/[^\d]/g, ""));
  d["Price"] = +d["Price"].replace(/[^\d.]/g, "");
  d["Size"] = +d["Size"].replace(/[^\d.]/g, "");

  if (/^\d/.test(d["Android Ver"])) {
    d["Android Ver"] = parseFloat(d["Android Ver"].match(/^\d+(\.\d+)?/)[0]);
  } else {
    d["Android Ver"] = 0;
  }

  d["Reviews"] = +d["Reviews"];


  if (!uniqueDataMap.has(d["App"])) {

    uniqueDataMap.set(d["App"], d);
  }
});




let uniqueData = Array.from(uniqueDataMap.values());


const columns = Object.keys(uniqueData[0]);


data = uniqueData;

data.columns = columns;


      scatterplot = new Scatterplot("#scatterplot", data);
      scatterplot.initialize();

      updateScatterplot();

      d3.selectAll("input[type=radio][name=x-encoding]").on(
        "change",
        updateScatterplot
      );
      d3.selectAll("input[type=radio][name=y-encoding]").on(
        "change",
        updateScatterplot
      );
      d3.selectAll("#use-color").on("change", updateScatterplot);
      d3.selectAll("#options").on("change", updateHistogram);
      d3.selectAll("#use-datatype").on("change",updateDataTable);
      d3.selectAll("#options1").on("change",updateDataTable);
 

      scatterplot.on("brush", (brushedItems) => {
        brushedData = brushedItems;
        updateHistogram();
        updateDataTable();
        updatepiegraph();
      });

      histogram = new Histogram("#histogram");
      histogram.initialize();

      updateHistogram();

     
     
    
    
      piegraph=new piegraph("#piegraph");

      piegraph.initialize();
      
      updatepiegraph();
      dataTable = new DataTable("#data-table");
     
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
